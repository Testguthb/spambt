#!/bin/bash

# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ ÑƒÐ¿Ñ€Ð°Ð²Ð»Ñ–Ð½Ð½Ñ Ð¿'ÑÑ‚ÑŒÐ¼Ð° ÐµÐºÐ·ÐµÐ¼Ð¿Ð»ÑÑ€Ð°Ð¼Ð¸ Telegram Ð±Ð¾Ñ‚Ð°

case "$1" in
    start)
        echo "ðŸš€ Ð—Ð°Ð¿ÑƒÑÐºÐ°ÑŽ Ð²ÑÑ– Ð±Ð¾Ñ‚Ð¸..."
        pm2 start ecosystem.config.js
        echo "âœ… Ð‘Ð¾Ñ‚Ð¸ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ñ–!"
        pm2 status
        ;;
    stop)
        echo "ðŸ›‘ Ð—ÑƒÐ¿Ð¸Ð½ÑÑŽ Ð²ÑÑ– Ð±Ð¾Ñ‚Ð¸..."
        pm2 stop bot1 bot2 bot3 bot4 bot5
        echo "âœ… Ð‘Ð¾Ñ‚Ð¸ Ð·ÑƒÐ¿Ð¸Ð½ÐµÐ½Ñ–!"
        ;;
    restart)
        echo "ðŸ”„ ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐºÐ°ÑŽ Ð²ÑÑ– Ð±Ð¾Ñ‚Ð¸..."
        pm2 restart bot1 bot2 bot3 bot4 bot5
        echo "âœ… Ð‘Ð¾Ñ‚Ð¸ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ñ–!"
        ;;
    status)
        echo "ðŸ“Š Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð±Ð¾Ñ‚Ñ–Ð²:"
        pm2 status
        ;;
    logs)
        if [ -z "$2" ]; then
            echo "ðŸ“œ ÐŸÐ¾ÐºÐ°Ð·ÑƒÑŽ Ð»Ð¾Ð³Ð¸ Ð²ÑÑ–Ñ… Ð±Ð¾Ñ‚Ñ–Ð²:"
            pm2 logs
        else
            echo "ðŸ“œ ÐŸÐ¾ÐºÐ°Ð·ÑƒÑŽ Ð»Ð¾Ð³Ð¸ Ð±Ð¾Ñ‚Ð° $2:"
            pm2 logs "$2"
        fi
        ;;
    logs-follow)
        if [ -z "$2" ]; then
            echo "ðŸ“œ Ð¡Ð»Ñ–Ð´ÐºÑƒÑŽ Ð·Ð° Ð»Ð¾Ð³Ð°Ð¼Ð¸ Ð²ÑÑ–Ñ… Ð±Ð¾Ñ‚Ñ–Ð²:"
            pm2 logs --lines 50
        else
            echo "ðŸ“œ Ð¡Ð»Ñ–Ð´ÐºÑƒÑŽ Ð·Ð° Ð»Ð¾Ð³Ð°Ð¼Ð¸ Ð±Ð¾Ñ‚Ð° $2:"
            pm2 logs "$2" --lines 50
        fi
        ;;
    monit)
        echo "ðŸ“ˆ Ð’Ñ–Ð´ÐºÑ€Ð¸Ð²Ð°ÑŽ Ð¼Ð¾Ð½Ñ–Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ PM2:"
        pm2 monit
        ;;
    setup)
        echo "âš™ï¸ ÐÐ°Ð»Ð°ÑˆÑ‚Ð¾Ð²ÑƒÑŽ ÐºÐ¾Ð½Ñ„Ñ–Ð³ÑƒÑ€Ð°Ñ†Ñ–Ð¹Ð½Ñ– Ñ„Ð°Ð¹Ð»Ð¸..."
        
        for i in {1..5}; do
            if [ ! -f ".env.bot$i" ]; then
                echo "ðŸ“ Ð¡Ñ‚Ð²Ð¾Ñ€ÑŽÑŽ .env.bot$i..."
                cat > .env.bot$i << EOF
# ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ ÑÐºÐ·ÐµÐ¼Ð¿Ð»ÑÑ€Ð° Ð±Ð¾Ñ‚Ð° $i
API_ID=your_api_id_$i
API_HASH=your_api_hash_$i
BOT_TOKEN=your_bot_token_$i
ADMIN_ID_LIST=your_admin_ids
DATABASE_NAME=sessions_bot$i.db
BOT_NAME=bot$i
EOF
                echo "âœ… Ð¤Ð°Ð¹Ð» .env.bot$i ÑÑ‚Ð²Ð¾Ñ€ÐµÐ½Ð¾. Ð’Ñ–Ð´Ñ€ÐµÐ´Ð°Ð³ÑƒÐ¹Ñ‚Ðµ Ð¹Ð¾Ð³Ð¾ Ð· Ð²Ð°ÑˆÐ¸Ð¼Ð¸ Ð´Ð°Ð½Ð¸Ð¼Ð¸!"
            else
                echo "âš ï¸ Ð¤Ð°Ð¹Ð» .env.bot$i Ð²Ð¶Ðµ Ñ–ÑÐ½ÑƒÑ”"
            fi
        done
        
        echo ""
        echo "ðŸ“‹ ÐÐµ Ð·Ð°Ð±ÑƒÐ´ÑŒÑ‚Ðµ Ð²Ñ–Ð´Ñ€ÐµÐ´Ð°Ð³ÑƒÐ²Ð°Ñ‚Ð¸ Ñ„Ð°Ð¹Ð»Ð¸ .env.bot1 - .env.bot5 Ð· Ð²Ð°ÑˆÐ¸Ð¼Ð¸ Ð´Ð°Ð½Ð¸Ð¼Ð¸:"
        echo "   - API_ID Ñ‚Ð° API_HASH Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ð¹Ñ‚Ðµ Ð· https://my.telegram.org"
        echo "   - BOT_TOKEN Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ð¹Ñ‚Ðµ Ð²Ñ–Ð´ @BotFather"
        echo "   - ADMIN_ID_LIST - Ð²Ð°ÑˆÑ– Telegram ID Ñ‡ÐµÑ€ÐµÐ· ÐºÐ¾Ð¼Ñƒ"
        ;;
    start-bot)
        if [ -z "$2" ]; then
            echo "âŒ ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¾ Ð²ÐºÐ°Ð·Ð°Ñ‚Ð¸ Ð½Ð¾Ð¼ÐµÑ€ Ð±Ð¾Ñ‚Ð° (1-5)"
            echo "ÐŸÑ€Ð¸ÐºÐ»Ð°Ð´: $0 start-bot 1"
        else
            echo "ðŸš€ Ð—Ð°Ð¿ÑƒÑÐºÐ°ÑŽ Ð±Ð¾Ñ‚Ð° $2..."
            pm2 start bot$2
            echo "âœ… Ð‘Ð¾Ñ‚ $2 Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð¸Ð¹!"
        fi
        ;;
    stop-bot)
        if [ -z "$2" ]; then
            echo "âŒ ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¾ Ð²ÐºÐ°Ð·Ð°Ñ‚Ð¸ Ð½Ð¾Ð¼ÐµÑ€ Ð±Ð¾Ñ‚Ð° (1-5)"
            echo "ÐŸÑ€Ð¸ÐºÐ»Ð°Ð´: $0 stop-bot 1"
        else
            echo "ðŸ›‘ Ð—ÑƒÐ¿Ð¸Ð½ÑÑŽ Ð±Ð¾Ñ‚Ð° $2..."
            pm2 stop bot$2
            echo "âœ… Ð‘Ð¾Ñ‚ $2 Ð·ÑƒÐ¿Ð¸Ð½ÐµÐ½Ð¸Ð¹!"
        fi
        ;;
    restart-bot)
        if [ -z "$2" ]; then
            echo "âŒ ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¾ Ð²ÐºÐ°Ð·Ð°Ñ‚Ð¸ Ð½Ð¾Ð¼ÐµÑ€ Ð±Ð¾Ñ‚Ð° (1-5)"
            echo "ÐŸÑ€Ð¸ÐºÐ»Ð°Ð´: $0 restart-bot 1"
        else
            echo "ðŸ”„ ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐºÐ°ÑŽ Ð±Ð¾Ñ‚Ð° $2..."
            pm2 restart bot$2
            echo "âœ… Ð‘Ð¾Ñ‚ $2 Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð¸Ð¹!"
        fi
        ;;
    *)
        echo "ðŸ¤– Ð£Ð¿Ñ€Ð°Ð²Ð»Ñ–Ð½Ð½Ñ Ð¿'ÑÑ‚ÑŒÐ¼Ð° ÐµÐºÐ·ÐµÐ¼Ð¿Ð»ÑÑ€Ð°Ð¼Ð¸ Telegram Ð±Ð¾Ñ‚Ð°"
        echo ""
        echo "Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½Ñ: $0 {start|stop|restart|status|logs|logs-follow|monit|setup|start-bot|stop-bot|restart-bot}"
        echo ""
        echo "ÐšÐ¾Ð¼Ð°Ð½Ð´Ð¸ Ð´Ð»Ñ Ð²ÑÑ–Ñ… Ð±Ð¾Ñ‚Ñ–Ð²:"
        echo "  start        - Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ð¸ Ð²ÑÑ– Ð±Ð¾Ñ‚Ð¸"
        echo "  stop         - Ð—ÑƒÐ¿Ð¸Ð½Ð¸Ñ‚Ð¸ Ð²ÑÑ– Ð±Ð¾Ñ‚Ð¸"
        echo "  restart      - ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ð¸ Ð²ÑÑ– Ð±Ð¾Ñ‚Ð¸"
        echo "  status       - ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð±Ð¾Ñ‚Ñ–Ð²"
        echo "  logs [bot]   - ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ Ð»Ð¾Ð³Ð¸ (bot1-bot5 Ð°Ð±Ð¾ Ð²ÑÑ–)"
        echo "  logs-follow [bot] - Ð¡Ð»Ñ–Ð´ÐºÑƒÐ²Ð°Ñ‚Ð¸ Ð·Ð° Ð»Ð¾Ð³Ð°Ð¼Ð¸ Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼Ñƒ Ñ‡Ð°ÑÑ–"
        echo "  monit        - Ð’Ñ–Ð´ÐºÑ€Ð¸Ñ‚Ð¸ PM2 Ð¼Ð¾Ð½Ñ–Ñ‚Ð¾Ñ€"
        echo "  setup        - Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ ÐºÐ¾Ð½Ñ„Ñ–Ð³ÑƒÑ€Ð°Ñ†Ñ–Ð¹Ð½Ñ– Ñ„Ð°Ð¹Ð»Ð¸"
        echo ""
        echo "ÐšÐ¾Ð¼Ð°Ð½Ð´Ð¸ Ð´Ð»Ñ Ð¾ÐºÑ€ÐµÐ¼Ð¸Ñ… Ð±Ð¾Ñ‚Ñ–Ð²:"
        echo "  start-bot N  - Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ð¸ Ð±Ð¾Ñ‚Ð° N (1-5)"
        echo "  stop-bot N   - Ð—ÑƒÐ¿Ð¸Ð½Ð¸Ñ‚Ð¸ Ð±Ð¾Ñ‚Ð° N (1-5)"
        echo "  restart-bot N - ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ð¸ Ð±Ð¾Ñ‚Ð° N (1-5)"
        echo ""
        echo "ÐŸÑ€Ð¸ÐºÐ»Ð°Ð´Ð¸:"
        echo "  $0 start                 # Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ð¸ Ð²ÑÑ– Ð±Ð¾Ñ‚Ð¸"
        echo "  $0 logs bot1            # ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ Ð»Ð¾Ð³Ð¸ Ð¿ÐµÑ€ÑˆÐ¾Ð³Ð¾ Ð±Ð¾Ñ‚Ð°"
        echo "  $0 logs-follow bot2     # Ð¡Ð»Ñ–Ð´ÐºÑƒÐ²Ð°Ñ‚Ð¸ Ð·Ð° Ð»Ð¾Ð³Ð°Ð¼Ð¸ Ð´Ñ€ÑƒÐ³Ð¾Ð³Ð¾ Ð±Ð¾Ñ‚Ð°"
        echo "  $0 start-bot 3          # Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ð¸ Ñ‚Ñ–Ð»ÑŒÐºÐ¸ Ñ‚Ñ€ÐµÑ‚Ñ–Ð¹ Ð±Ð¾Ñ‚"
        echo "  $0 setup                # Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ .env Ñ„Ð°Ð¹Ð»Ð¸"
        ;;
esac